[tox]
envlist = py311,py312,tests,lint,format,typecheck,docs,cov
isolated_build = true

[testenv]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
commands = pytest {posargs}

[testenv:tests]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
commands = pytest

[testenv:cov]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
commands = 
    pytest --cov=src/{{cookiecutter.package_name}} --cov-report=html --cov-report=term-missing {posargs}

[testenv:lint]
deps = ruff>=0.1.0
commands = ruff check .

[testenv:format]
deps = 
    black>=23.0.0
    ruff>=0.1.0
commands = 
    black .
    ruff check --fix .

[testenv:typecheck]
deps = mypy>=1.0.0
commands = mypy src/{{cookiecutter.package_name}}

[testenv:docs]
deps = 
    sphinx>=6.0.0
    sphinx-autodoc-typehints>=1.24.0
    sphinx-rtd-theme>=1.3.0
commands = 
    sphinx-build -W -b html docs docs/_build/html

[testenv:clean]
deps = 
commands = 
    python -c "import shutil; shutil.rmtree('build', ignore_errors=True)"
    python -c 'import shutil; shutil.rmtree("dist", ignore_errors=True)'
    python -c 'import shutil; shutil.rmtree("htmlcov", ignore_errors=True)'
    python -c 'import shutil; shutil.rmtree("docs/_build", ignore_errors=True)'
    python -c 'import shutil; shutil.rmtree(".pytest_cache", ignore_errors=True)'
    python -c "import shutil; shutil.rmtree('.mypy_cache', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.ruff_cache', ignore_errors=True)"
    python -c "import pathlib; [p.unlink() for p in pathlib.Path('.').rglob('*.egg-info')]"

[testenv:quality]
deps = 
    pytest>=7.0.0
    pytest-cov>=4.0.0
    ruff>=0.1.0
    black>=23.0.0
    mypy>=1.0.0
commands = 
    ruff check .
    black --check .
    mypy src/{{cookiecutter.package_name}}
    pytest --cov=src/{{cookiecutter.package_name}} --cov-fail-under=85 {posargs}

[testenv:install]
deps = 
    setuptools>=61.0
    wheel
commands = 
    pip install -e .

[testenv:install-dev]
deps = 
    setuptools>=61.0
    wheel
commands = 
    pip install -e ".[dev]"

[testenv:serve-docs]
deps = 
    sphinx>=6.0.0
commands = 
    sphinx-build -W -b html docs docs/_build/html
    python -m http.server 8000 --directory docs/_build/html